###############################################################################
# mtg 完整配置模板（可生产使用）
###############################################################################

# 是否开启 debug（生产环境建议 false）
debug = false

# FakeTLS secret（必须以 ee 开头）
secret = "${SECRET}"

# 监听端口
bind-to = "0.0.0.0:${PORT}"

# 最大并发连接数
concurrency = 8192

# IPv4 / IPv6 策略
prefer-ip = "prefer-ipv4"

# FakeTLS 伪装端口（一般为 443）
domain-fronting-port = 443

# FakeTLS 时间偏移容忍
tolerate-time-skewness = "5s"

# 是否允许未知 DC fallback
allow-fallback-on-unknown-dc = false


###############################################################################
# Network 配置
###############################################################################
[network]
# DNS-over-HTTPS 服务器
doh-ip = "${DOH_IP}"

# 代理链（一般不需要）
proxies = [
    # "socks5://user:password@host:port"
]

[network.timeout]
tcp = "5s"
http = "10s"
idle = "1m"


###############################################################################
# 防御（Anti-Replay / Blocklist / Allowlist）
###############################################################################
[defense.anti-replay]
enabled = true
max-size = "1mib"
error-rate = 0.001

[defense.blocklist]
enabled = true
download-concurrency = 2
urls = [
    "https://iplists.firehol.org/files/firehol_level1.netset",
]
update-each = "24h"

[defense.allowlist]
enabled = false
download-concurrency = 2
urls = [
]
update-each = "24h"


###############################################################################
# Metrics（StatsD / Prometheus）
###############################################################################
[stats.statsd]
enabled = false
address = "127.0.0.1:8888"
metric-prefix = "mtg"
tag-format = "datadog"

[stats.prometheus]
enabled = true
bind-to = "127.0.0.1:3129"
http-path = "/"
metric-prefix = "mtg"
